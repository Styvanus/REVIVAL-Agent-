<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Revival Agent School - Report Card Recorder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(to bottom right, #e0f2fe, #bfdbfe);
            font-family: 'Arial', sans-serif;
        }
        @media print {
            body {
                background: none;
            }
            .no-print {
                display: none;
            }
            .report-card {
                margin: 0;
                padding: 20px;
                border: none;
                box-shadow: none;
            }
            .report-card table {
                width: 100%;
                border-collapse: collapse;
            }
            .report-card table, .report-card th, .report-card td {
                border: 1px solid black;
                padding: 8px;
            }
            .logo {
                max-width: 100px;
                margin: 0 auto;
            }
        }
    </style>
</head>
<body class="min-h-screen p-6">
    <header class="text-center mb-8">
        <img src="https://via.placeholder.com/100" alt="School Logo" class="logo mx-auto mb-4">
        <h1 class="text-4xl font-bold text-blue-800">Revival Agent School</h1>
        <h2 class="text-2xl font-semibold text-blue-600">Report Card Recorder</h2>
    </header>

    <section class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg mb-8">
        <h3 class="text-xl font-bold text-blue-700 mb-4">Enter Student Details and Grades</h3>
        <form id="reportForm" class="space-y-4">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label for="studentName" class="block text-sm font-medium text-gray-700">Student Name:</label>
                    <input type="text" id="studentName" class="mt-1 p-2 w-full border rounded-md" required>
                </div>
                <div>
                    <label for="admissionNumber" class="block text-sm font-medium text-gray-700">Admission Number:</label>
                    <input type="text" id="admissionNumber" class="mt-1 p-2 w-full border rounded-md" required>
                </div>
                <div>
                    <label for="class" class="block text-sm font-medium text-gray-700">Class:</label>
                    <select id="class" class="mt-1 p-2 w-full border rounded-md" required>
                        <option value="">Select Class</option>
                        <option value="Primary 1">Primary 1</option>
                        <option value="Primary 2">Primary 2</option>
                        <option value="Primary 3">Primary 3</option>
                        <option value="Primary 4">Primary 4</option>
                        <option value="Primary 5">Primary 5</option>
                        <option value="Primary 6">Primary 6</option>
                        <option value="JSS 1">JSS 1</option>
                        <option value="JSS 2">JSS 2</option>
                        <option value="JSS 3">JSS 3</option>
                        <option value="SSS 1">SSS 1</option>
                        <option value="SSS 2">SSS 2</option>
                        <option value="SSS 3">SSS 3</option>
                    </select>
                </div>
                <div>
                    <label for="term" class="block text-sm font-medium text-gray-700">Term:</label>
                    <select id="term" class="mt-1 p-2 w-full border rounded-md" required>
                        <option value="">Select Term</option>
                        <option value="First Term">First Term</option>
                        <option value="Second Term">Second Term</option>
                        <option value="Third Term">Third Term</option>
                    </select>
                </div>
                <div>
                    <label for="session" class="block text-sm font-medium text-gray-700">Academic Session:</label>
                    <input type="text" id="session" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 2024/2025" required>
                </div>
                <div>
                    <label for="overallPosition" class="block text-sm font-medium text-gray-700">Overall Position:</label>
                    <input type="text" id="overallPosition" class="mt-1 p-2 w-full border rounded-md" placeholder="e.g., 1st, 2nd, 3rd">
                </div>
            </div>

            <div>
                <label class="block text-sm font-medium text-gray-700">Subject Scores (1st Test: 20, 2nd Test: 20, 3rd Test: 20, Exam: 40)</label>
                <div id="subjects" class="space-y-2">
                    <div class="subject-row flex space-x-2">
                        <input type="text" class="subject-name p-2 w-1/4 border rounded-md" placeholder="Subject" required>
                        <input type="number" class="test1 p-2 w-1/6 border rounded-md" placeholder="1st Test (20)" min="0" max="20" required>
                        <input type="number" class="test2 p-2 w-1/6 border rounded-md" placeholder="2nd Test (20)" min="0" max="20" required>
                        <input type="number" class="test3 p-2 w-1/6 border rounded-md" placeholder="3rd Test (20)" min="0" max="20" required>
                        <input type="number" class="exam p-2 w-1/6 border rounded-md" placeholder="Exam (40)" min="0" max="40" required>
                        <input type="text" class="position p-2 w-1/6 border rounded-md" placeholder="Position" required>
                        <button type="button" class="remove-subject bg-red-500 text-white px-2 py-1 rounded-md">Remove</button>
                    </div>
                </div>
                <button type="button" id="addSubject" class="mt-2 bg-blue-500 text-white px-4 py-2 rounded-md">Add Subject</button>
            </div>

            <div>
                <label for="teacherRemarks" class="block text-sm font-medium text-gray-700">Teacher's Remarks:</label>
                <textarea id="teacherRemarks" class="mt-1 p-2 w-full border rounded-md"></textarea>
            </div>
            <div>
                <label for="principalRemarks" class="block text-sm font-medium text-gray-700">Principal's Remarks:</label>
                <textarea id="principalRemarks" class="mt-1 p-2 w-full border rounded-md"></textarea>
            </div>

            <div class="flex space-x-4">
                <button type="submit" class="bg-green-500 text-white px-4 py-2 rounded-md">Generate Report Card</button>
                <button type="button" id="clearForm" class="bg-gray-500 text-white px-4 py-2 rounded-md">Clear Form</button>
            </div>
        </form>
    </section>

    <section id="reportCard" class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg mb-8 report-card hidden">
        <header class="text-center mb-6">
            <img src="https://via.placeholder.com/100" alt="School Logo" class="logo mx-auto mb-4">
            <h1 class="text-3xl font-bold text-blue-800">Revival Agent School</h1>
            <h2 class="text-xl font-semibold text-blue-600">Report Card</h2>
        </header>
        <div class="space-y-4">
            <p><strong>Student Name:</strong> <span id="reportStudentName"></span></p>
            <p><strong>Admission Number:</strong> <span id="reportAdmissionNumber"></span></p>
            <p><strong>Class:</strong> <span id="reportClass"></span></p>
            <p><strong>Term:</strong> <span id="reportTerm"></span></p>
            <p><strong>Academic Session:</strong> <span id="reportSession"></span></p>
            <h3 class="text-lg font-bold text-blue-700">Grades:</h3>
            <table class="w-full border-collapse">
                <thead>
                    <tr class="bg-blue-100">
                        <th class="border p-2">Subject</th>
                        <th class="border p-2">1st Test (20)</th>
                        <th class="border p-2">2nd Test (20)</th>
                        <th class="border p-2">3rd Test (20)</th>
                        <th class="border p-2">Exam (40)</th>
                        <th class="border p-2">Total (100)</th>
                        <th class="border p-2">Grade</th>
                        <th class="border p-2">Position</th>
                    </tr>
                </thead>
                <tbody id="reportGrades"></tbody>
            </table>
            <div class="space-y-2">
                <p><strong>Overall Total Score:</strong> <span id="overallTotal"></span></p>
                <p><strong>Overall Average Score:</strong> <span id="overallAverage"></span></p>
                <p><strong>Overall Position:</strong> <span id="overallPosition"></span></p>
                <p><strong>Cumulative Total (Third Term):</strong> <span id="cumulativeTotal"></span></p>
                <p><strong>Cumulative Average (Third Term):</strong> <span id="cumulativeAverage"></span></p>
            </div>
            <p><strong>Teacher's Remarks:</strong> <span id="reportTeacherRemarks"></span></p>
            <p><strong>Principal's Remarks:</strong> <span id="reportPrincipalRemarks"></span></p>
        </div>
        <div class="flex space-x-4 mt-4">
            <button id="printReport" class="bg-blue-500 text-white px-4 py-2 rounded-md no-print">Print Report Card</button>
            <button id="saveReport" class="bg-green-500 text-white px-4 py-2 rounded-md no-print">Save Report Card</button>
        </div>
    </section>

    <section class="max-w-4xl mx-auto bg-white p-6 rounded-lg shadow-lg no-print">
        <h3 class="text-xl font-bold text-blue-700 mb-4">Saved Report Cards (Local Storage)</h3>
        <p class="text-sm text-gray-600 mb-4">Note: Data saved here is only on *this browser and device*. For permanent storage, a backend system is required.</p>
        <div id="savedReports" class="space-y-2"></div>
    </section>

    <script>
        function getGrade(total) {
            if (total >= 70) return 'A';
            if (total >= 60) return 'B';
            if (total >= 50) return 'C';
            if (total >= 45) return 'D';
            if (total >= 40) return 'E';
            return 'F';
        }

        document.getElementById('addSubject').addEventListener('click', () => {
            const subjectsDiv = document.getElementById('subjects');
            const newRow = document.createElement('div');
            newRow.className = 'subject-row flex space-x-2';
            newRow.innerHTML = `
                <input type="text" class="subject-name p-2 w-1/4 border rounded-md" placeholder="Subject" required>
                <input type="number" class="test1 p-2 w-1/6 border rounded-md" placeholder="1st Test (20)" min="0" max="20" required>
                <input type="number" class="test2 p-2 w-1/6 border rounded-md" placeholder="2nd Test (20)" min="0" max="20" required>
                <input type="number" class="test3 p-2 w-1/6 border rounded-md" placeholder="3rd Test (20)" min="0" max="20" required>
                <input type="number" class="exam p-2 w-1/6 border rounded-md" placeholder="Exam (40)" min="0" max="40" required>
                <input type="text" class="position p-2 w-1/6 border rounded-md" placeholder="Position" required>
                <button type="button" class="remove-subject bg-red-500 text-white px-2 py-1 rounded-md">Remove</button>
            `;
            subjectsDiv.appendChild(newRow);
            newRow.querySelector('.remove-subject').addEventListener('click', () => newRow.remove());
        });

        document.getElementById('clearForm').addEventListener('click', () => {
            document.getElementById('reportForm').reset();
            document.getElementById('subjects').innerHTML = `
                <div class="subject-row flex space-x-2">
                    <input type="text" class="subject-name p-2 w-1/4 border rounded-md" placeholder="Subject" required>
                    <input type="number" class="test1 p-2 w-1/6 border rounded-md" placeholder="1st Test (20)" min="0" max="20" required>
                    <input type="number" class="test2 p-2 w-1/6 border rounded-md" placeholder="2nd Test (20)" min="0" max="20" required>
                    <input type="number" class="test3 p-2 w-1/6 border rounded-md" placeholder="3rd Test (20)" min="0" max="20" required>
                    <input type="number" class="exam p-2 w-1/6 border rounded-md" placeholder="Exam (40)" min="0" max="40" required>
                    <input type="text" class="position p-2 w-1/6 border rounded-md" placeholder="Position" required>
                    <button type="button" class="remove-subject bg-red-500 text-white px-2 py-1 rounded-md">Remove</button>
                </div>
            `;
            document.getElementById('reportCard').classList.add('hidden');
        });

        document.getElementById('reportForm').addEventListener('submit', (e) => {
            e.preventDefault();
            const studentName = document.getElementById('studentName').value;
            const admissionNumber = document.getElementById('admissionNumber').value;
            const studentClass = document.getElementById('class').value;
            const term = document.getElementById('term').value;
            const session = document.getElementById('session').value;
            const overallPosition = document.getElementById('overallPosition').value;
            const teacherRemarks = document.getElementById('teacherRemarks').value;
            const principalRemarks = document.getElementById('principalRemarks').value;

            const subjects = Array.from(document.querySelectorAll('.subject-row')).map(row => {
                const subjectName = row.querySelector('.subject-name').value;
                const test1 = parseFloat(row.querySelector('.test1').value) || 0;
                const test2 = parseFloat(row.querySelector('.test2').value) || 0;
                const test3 = parseFloat(row.querySelector('.test3').value) || 0;
                const exam = parseFloat(row.querySelector('.exam').value) || 0;
                const position = row.querySelector('.position').value;
                const total = test1 + test2 + test3 + exam;
                const grade = getGrade(total);
                return { subjectName, test1, test2, test3, exam, total, grade, position };
            });

            const overallTotal = subjects.reduce((sum, s) => sum + s.total, 0);
            const overallAverage = (overallTotal / (subjects.length * 100) * 100).toFixed(2);

            // Calculate cumulative scores for Third Term
            let cumulativeTotal = overallTotal;
            let cumulativeAverage = overallAverage;
            let totalTerms = 1;
            let cumulativeSubjectCount = subjects.length;
            if (term === 'Third Term') {
                const savedReports = JSON.parse(localStorage.getItem('reportCards') || '[]');
                const firstTerm = savedReports.find(r => r.admissionNumber === admissionNumber && r.term === 'First Term' && r.session === session);
                const secondTerm = savedReports.find(r => r.admissionNumber === admissionNumber && r.term === 'Second Term' && r.session === session);
                if (firstTerm) {
                    cumulativeTotal += firstTerm.overallTotal;
                    cumulativeSubjectCount += firstTerm.grades.length;
                    totalTerms++;
                }
                if (secondTerm) {
                    cumulativeTotal += secondTerm.overallTotal;
                    cumulativeSubjectCount += secondTerm.grades.length;
                    totalTerms++;
                }
                cumulativeAverage = (cumulativeTotal / (cumulativeSubjectCount * 100) * 100).toFixed(2);
            }

            // Populate report card
            document.getElementById('reportStudentName').textContent = studentName;
            document.getElementById('reportAdmissionNumber').textContent = admissionNumber;
            document.getElementById('reportClass').textContent = studentClass;
            document.getElementById('reportTerm').textContent = term;
            document.getElementById('reportSession').textContent = session;
            document.getElementById('reportTeacherRemarks').textContent = teacherRemarks;
            document.getElementById('reportPrincipalRemarks').textContent = principalRemarks;
            document.getElementById('overallTotal').textContent = overallTotal;
            document.getElementById('overallAverage').textContent = overallAverage;
            document.getElementById('overallPosition').textContent = overallPosition || 'N/A';
            document.getElementById('cumulativeTotal').textContent = term === 'Third Term' ? cumulativeTotal : 'N/A';
            document.getElementById('cumulativeAverage').textContent = term === 'Third Term' ? cumulativeAverage : 'N/A';

            const gradesTable = document.getElementById('reportGrades');
            gradesTable.innerHTML = subjects.map(s => `
                <tr>
                    <td class="border p-2">${s.subjectName}</td>
                    <td class="border p-2">${s.test1}</td>
                    <td class="border p-2">${s.test2}</td>
                    <td class="border p-2">${s.test3}</td>
                    <td class="border p-2">${s.exam}</td>
                    <td class="border p-2">${s.total}</td>
                    <td class="border p-2">${s.grade}</td>
                    <td class="border p-2">${s.position}</td>
                </tr>
            `).join('');

            document.getElementById('reportCard').classList.remove('hidden');
        });

        document.getElementById('printReport').addEventListener('click', () => {
            window.print();
        });

        document.getElementById('saveReport').addEventListener('click', () => {
            const report = {
                studentName: document.getElementById('reportStudentName').textContent,
                admissionNumber: document.getElementById('reportAdmissionNumber').textContent,
                class: document.getElementById('reportClass').textContent,
                term: document.getElementById('reportTerm').textContent,
                session: document.getElementById('reportSession').textContent,
                grades: Array.from(document.getElementById('reportGrades').children).map(row => ({
                    subjectName: row.children[0].textContent,
                    test1: parseFloat(row.children[1].textContent),
                    test2: parseFloat(row.children[2].textContent),
                    test3: parseFloat(row.children[3].textContent),
                    exam: parseFloat(row.children[4].textContent),
                    total: parseFloat(row.children[5].textContent),
                    grade: row.children[6].textContent,
                    position: row.children[7].textContent
                })),
                overallTotal: parseFloat(document.getElementById('overallTotal').textContent),
                overallAverage: parseFloat(document.getElementById('overallAverage').textContent),
                overallPosition: document.getElementById('overallPosition').textContent,
                teacherRemarks: document.getElementById('reportTeacherRemarks').textContent,
                principalRemarks: document.getElementById('reportPrincipalRemarks').textContent,
                cumulativeTotal: document.getElementById('cumulativeTotal').textContent,
                cumulativeAverage: document.getElementById('cumulativeAverage').textContent
            };
            const savedReports = JSON.parse(localStorage.getItem('reportCards') || '[]');
            savedReports.push(report);
            localStorage.setItem('reportCards', JSON.stringify(savedReports));
            displaySavedReports();
        });

        function displaySavedReports() {
            const savedReports = JSON.parse(localStorage.getItem('reportCards') || '[]');
            const savedReportsDiv = document.getElementById('savedReports');
            savedReportsDiv.innerHTML = savedReports.map((report, index) => `
                <div class="border p-4 rounded-md">
                    <p><strong>Student:</strong> ${report.studentName}</p>
                    <p><strong>Admission Number:</strong> ${report.admissionNumber}</p>
                    <p><strong>Class:</strong> ${report.class}</p>
                    <p><strong>Term:</strong> ${report.term}</p>
                    <p><strong>Session:</strong> ${report.session}</p>
                    <button class="view-report bg-blue-500 text-white px-4 py-2 rounded-md mt-2" data-index="${index}">View Report</button>
                </div>
            `).join('');
            document.querySelectorAll('.view-report').forEach(button => {
                button.addEventListener('click', () => {
                    const index = button.getAttribute('data-index');
                    const report = savedReports[index];
                    document.getElementById('reportStudentName').textContent = report.studentName;
                    document.getElementById('reportAdmissionNumber').textContent = report.admissionNumber;
                    document.getElementById('reportClass').textContent = report.class;
                    document.getElementById('reportTerm').textContent = report.term;
                    document.getElementById('reportSession').textContent = report.session;
                    document.getElementById('reportTeacherRemarks').textContent = report.teacherRemarks;
                    document.getElementById('reportPrincipalRemarks').textContent = report.principalRemarks;
                    document.getElementById('overallTotal').textContent = report.overallTotal;
                    document.getElementById('overallAverage').textContent = report.overallAverage;
                    document.getElementById('overallPosition').textContent = report.overallPosition;
                    document.getElementById('cumulativeTotal').textContent = report.cumulativeTotal;
                    document.getElementById('cumulativeAverage').textContent = report.cumulativeAverage;
                    document.getElementById('reportGrades').innerHTML = report.grades.map(s => `
                        <tr>
                            <td class="border p-2">${s.subjectName}</td>
                            <td class="border p-2">${s.test1}</td>
                            <td class="border p-2">${s.test2}</td>
                            <td class="border p-2">${s.test3}</td>
                            <td class="border p-2">${s.exam}</td>
                            <td class="border p-2">${s.total}</td>
                            <td class="border p-2">${s.grade}</td>
                            <td class="border p-2">${s.position}</td>
                        </tr>
                    `).join('');
                    document.getElementById('reportCard').classList.remove('hidden');
                });
            });
        }

        document.addEventListener('DOMContentLoaded', displaySavedReports);
    </script>
</body>
</html>